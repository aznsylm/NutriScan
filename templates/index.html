<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NUTRISCAN v3</title>
    <style>
        body {
            font-family: monospace;
            padding: 15px;
            background: #f4f4f4;
            color: #222;
        }

        .box {
            background: white;
            border: 2px solid #000;
            padding: 20px;
            max-width: 400px;
            margin: auto;
            box-shadow: 5px 5px 0px #000;
        }

        h2 {
            text-align: center;
            border-bottom: 2px solid #000;
            padding-bottom: 10px;
            margin-top: 0;
        }

        .status-msg {
            font-size: 11px;
            background: #eee;
            padding: 5px;
            border: 1px solid #ccc;
            margin-bottom: 15px;
        }

        .input-group {
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        input[type="number"] {
            width: 80px;
            padding: 5px;
            border: 1px solid #000;
            font-family: monospace;
        }

        input[type="file"] {
            font-size: 11px;
            margin-bottom: 15px;
        }

        .btn {
            width: 100%;
            padding: 12px;
            background: #000;
            color: #fff;
            border: none;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }

        .btn:hover {
            background: #444;
        }

        .result-section {
            margin-top: 20px;
            border-top: 2px dashed #000;
            padding-top: 15px;
            display: none;
        }

        .nutri-card {
            border: 1px solid #000;
            padding: 8px;
            margin-bottom: 8px;
            font-size: 12px;
        }

        .tag {
            font-weight: bold;
            padding: 2px 5px;
            color: #fff;
            float: right;
        }

        /* Klasifikasi Warna Solid */
        .bg-red {
            background: #ff0000;
        }

        .bg-orange {
            background: #ff8800;
        }

        .bg-yellow {
            background: #ffff00;
            color: #000;
        }

        .bg-green {
            background: #00aa00;
        }

        .summary-box {
            padding: 15px;
            text-align: center;
            font-weight: bold;
            margin-top: 10px;
            border: 2px solid #000;
            color: #fff;
        }
    </style>
</head>

<body>

    <div class="box">
        <h2>NUTRISCAN</h2>

        <div id="status" class="status-msg">PILIH FOTO LABEL UNTUK MEMULAI.</div>
        <input type="file" id="imageInput" accept="image/*">

        <div class="input-group" style="background:#ffffcc; padding:5px; border:1px solid #999;">
            <span>JML SAJIAN DIMAKAN:</span>
            <input type="number" id="multiplier" value="1" min="1">
        </div>

        <div class="input-group"><span>GULA (g):</span><input type="number" id="v-gula" step="0.1"></div>
        <div class="input-group"><span>LEMAK (g):</span><input type="number" id="v-lemak" step="0.1"></div>
        <div class="input-group"><span>GARAM (mg):</span><input type="number" id="v-garam" step="0.1"></div>
        <div class="input-group"><span>ENERGI (kkal):</span><input type="number" id="v-energi" step="0.1"></div>

        <button class="btn" onclick="prosesHitung()">ANALISIS SEKARANG</button>

        <div id="resultArea" class="result-section">
            <div id="details"></div>
            <div id="summary" class="summary-box"></div>
        </div>
    </div>

    <script>
        const imageInput = document.getElementById('imageInput');
        const status = document.getElementById('status');

        imageInput.onchange = async () => {
            if (!imageInput.files[0]) return;
            status.innerText = "SEDANG MEMPROSES... HARAP TUNGGU.";

            const formData = new FormData();
            formData.append('image', imageInput.files[0]);

            try {
                const response = await fetch('/scan', { method: 'POST', body: formData });
                const data = await response.json();

                document.getElementById('v-gula').value = data.gula;
                document.getElementById('v-lemak').value = data.lemak;
                document.getElementById('v-garam').value = data.garam;
                document.getElementById('v-energi').value = data.energi;
                status.innerText = "SCAN BERHASIL. CEK & SESUAIKAN ANGKA.";
            } catch (err) {
                status.innerText = "GAGAL MENGHUBUNGI SERVER.";
            }
        };

        function prosesHitung() {
            const m = parseFloat(document.getElementById('multiplier').value) || 1;
            const data = {
                gula: (parseFloat(document.getElementById('v-gula').value) || 0) * m,
                lemak: (parseFloat(document.getElementById('v-lemak').value) || 0) * m,
                garam: (parseFloat(document.getElementById('v-garam').value) || 0) * m,
                energi: (parseFloat(document.getElementById('v-energi').value) || 0) * m
            };

            const batas = { gula: 50, lemak: 67, garam: 2000, energi: 2100 };
            let high = 0; let med = 0; let html = "";

            for (let key in data) {
                let persen = (data[key] / batas[key]) * 100;
                let label = "RENDAH"; let color = "bg-green";

                if (persen >= 67) { label = "TINGGI"; color = "bg-red"; high++; }
                else if (persen >= 34) { label = "SEDANG"; color = "bg-yellow"; med++; }

                html += `
                <div class="nutri-card">
                    <span class="tag ${color}">${label}</span>
                    <b>${key.toUpperCase()}</b><br>
                    Total: ${data[key].toFixed(1)} | Beban: ${persen.toFixed(1)}%
                </div>`;
            }

            document.getElementById('details').innerHTML = html;
            const sum = document.getElementById('summary');
            document.getElementById('resultArea').style.display = "block";

            if (high >= 2) {
                sum.className = "summary-box bg-red";
                sum.innerText = "TINGGI, SEBAIKNYA SANGAT DIBATASI";
            } else if (high === 1) {
                sum.className = "summary-box bg-orange";
                sum.innerText = "KURANGI PORSI KONSUMSI";
            } else if (med >= 1) {
                sum.className = "summary-box bg-yellow";
                sum.innerText = "DAPAT DIKONSUMSI SECUKUPNYA";
            } else {
                sum.className = "summary-box bg-green";
                sum.innerText = "AMAN, KONSUMSI WAJAR";
            }
        }
    </script>
</body>

</html>